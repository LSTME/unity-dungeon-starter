#####    ####################
#t t#    # d d d #T        d#
# Pl#    #D ddd D#########-##
#tbt#    #  tdt    ltltl t d#
##-##### ###### #############
#lt   T# # b|b  T#
######## #########
#
############
#  t l#    #
#t    | T t#
#  t l#    #
############
mapBlocks:
 - position: [4, 3]
   objects:
    - type: lever
      name: door1lever
      actions:
       onActivate:
        - open: door1
        - switchOn: door1lever
       onDeactivate:
        - close: door1
        - switchOff: door1lever
 - position: [3, 5]
   objects:
    - type: door
      name: door1
 - position: [2, 6]
   objects:
    - type: lever
      name: door1lever
      actions:
       onActivate:
        - open: door1
        - switchOn: door1lever
       onDeactivate:
        - close: door1
        - switchOff: door1lever
 - position: [2, 4]
   objects:
    - type: torch
      rotation: W
 - position: [4, 4]
   objects:
    - type: torch
      rotation: E
 - position: [7, 6]
   objects:
    - type: teleport
      teleport:
       target: [11, 6]
       rotation: E
 - position: [17, 6]
   objects:
    - type: teleport
      teleport:
       target: [3, 3]
       rotation: S
 - position: [3, 4]
   objects:
    - type: floor_button
      actions:
       onActivate:
        - open: door1
        - switchOn: door1lever
 - position: [12, 6]
   objects:
    - type: floor_button
      actions:
       onActivate:
        - open: door2
 - position: [13, 6]
   objects:
    - type: door
      name: door2
 - position: [14, 6]
   objects:
    - type: floor_button
      actions:
       onActivate:
        - close: door2
 - position: [14, 3]
   objects:
    - type: decoration
      model: table
 - position: [14, 4]
   objects:
    - type: decoration
      model: chair
      rotation: N
 - position: [14, 2]
   objects:
    - type: decoration
      model: chair
      rotation: S
 - position: [13, 3]
   objects:
    - type: decoration
      model: chair
      rotation: E
 - position: [15, 3]
   objects:
    - type: decoration
      model: chair
      rotation: W
 - position: [27, 3]
   objects:
    - type: door
      name: logicDoor
 - position: [20, 4]
   objects:
    - type: lever
      actions:
       onActivate:
        - setTrue: logicDoorV1
       onDeactivate:
        - setFalse: logicDoorV1
 - position: [22, 4]
   objects:
    - type: lever
      actions:
       onActivate:
        - setTrue: logicDoorV2
       onDeactivate:
        - setFalse: logicDoorV2
 - position: [24, 4]
   objects:
    - type: lever
      actions:
       onActivate:
        - setTrue: logicDoorV3
       onDeactivate:
        - setFalse: logicDoorV3
 - position: [28, 4]
   objects:
    - type: decoration
      model: broken_path
      rotation: E
 - position: [28, 2]
   objects:
    - type: decoration
      model: broken_path
      rotation: E
 - position: [19, 2]
   objects:
    - type: teleport
      teleport:
       target: [4, 11]      
       rotation: E
 - position: [7, 11]
   objects:
    - type: door
      name: countedDoor
 - position: [9, 11]
   objects:
    - type: teleport
      teleport:
       target: [27, 2]
       rotation: W
 - position: [6, 10]
   objects:
    - type: lever
      actions:
       onActivate:
        - increment: counter1
 - position: [6, 12]
   objects:
    - type: lever
      actions:
       onActivate:
        - decrement: counter1
gameLogic:
 variables:
  - name: logicDoorV1
    state: false
  - name: logicDoorV2
    state: false
  - name: logicDoorV3
    state: false
  - name: logicDoorV2V3Or
    state: false
 logic:
  - variables:
     - name: logicDoorV1
       negate: true
     - name: logicDoorV2V3Or
    actions:
     onTrue:
      - open: logicDoor
     onFalse:
      - close: logicDoor
    fireAlways: false
    andLogic: true
  - variables:
      - name: logicDoorV2
      - name: logicDoorV3
    andLogic: false
    fireAlways: true
    actions:
     onTrue:
      - setTrue: logicDoorV2V3Or
     onFalse:
      - setFalse: logicDoorV2V3Or
 counters:
  - name: counter1
    min: 0
    max: 6
    start: 3
    fireAlways: true
    actions:
     onMax:
      - open: countedDoor
     onMin:
      - open: countedDoor
     onElse:  
      - close: countedDoor  